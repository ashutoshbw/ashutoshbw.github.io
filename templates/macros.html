{% macro render_tag_links_of_post(post) %}
  {% set tags = post.taxonomies.tags %}
  {% if tags %}
    <span>
      {% for tag in tags %}
        <a href="{{ get_taxonomy_url(kind="tags", name=tag) }}">
          {{ tag }}
        </a>
      {% endfor %}
    </span>
  {% endif %}
{% endmacro render_tag_links_of_post %}

{% macro render_all_tags() %}
  {% set tagsObject = get_taxonomy(kind="tags", required=false) %}
  {% set tags = tagsObject.items %}
  {% for tag in tags | sort(attribute="pages") | reverse %}
    <a href="{{ tag.permalink | safe }}">{{ tag.name }} <sup>{{tag.pages | length}}</sup></a>
  {% endfor %}
{% endmacro render_all_tags %}

{% macro render_date(date) %}
  <time datetime="{{ date }}">{{ date | date(format='%e %B %Y') }}</time>
{% endmacro render_date %}

{% macro render_posts(posts) %}
  <ol reversed>
    {% for post in posts %}
      {% set target = '' %}
      {% if post.extra.canonical.url and post.extra.canonical.use_as_post_link %}
        {% set href = post.extra.canonical.url %}
        {% set target = ' target="_blank"' %}
      {% else %}
        {% set href = post.permalink %}
      {% endif %}
      <li>
        <a href="{{ href | safe }}"{{ target | safe }}>{{ post.title | markdown(inline=true) | safe }}</a>
        {{ self::render_date(date=post.date) }}
        {{ self::render_tag_links_of_post(post=post) }}
      </li>
    {% endfor %}
  </ol>
{% endmacro render_posts %}

{% macro render_gallery_photos(file) %}
  {% set data = load_data(path="@/gallery/" ~ file) %}
  {% for img_data in data %}
    {% set processed_img = resize_image(path="/content/gallery/" ~ img_data.file, width=161, height=100, op="fit") %}
    <a href="{{ get_url(path='gallery/' ~ img_data.file) }}">
      <img src="{{ processed_img.url | safe }}" alt="{{ img_data.alt }}" />
    </a>
  {% endfor %}
{% endmacro render_gallery_photos %}
